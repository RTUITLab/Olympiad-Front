<div *ngIf="isReady(); else notReady">
    <mat-drawer class="drawer" #drawer mode="over" position="end">
        <div class="header" style="font-size: 25px;">{{exerciseInfo.name}}</div>
        <app-task [exerciseInfo]="exerciseInfo" [inOutData]="inOutData"></app-task>
    </mat-drawer>
    <div class="cover" (click)="drawer.toggle()" *ngIf="drawer.opened"></div>
    
    <div class="view">
        <div class="progress">
            <div class="exercise" *ngFor="let exercise of exercises">
                <a class="statusCircle" [ngClass]="statusClass(exercise)" routerLink="/exercises/{{exercise.id}}"></a>
                <div class="exName">{{exercise.name}}</div>
            </div>
        </div>
        <div class="name">
            <div class="header">{{exerciseInfo.name}}</div>
            <div class="info">Баллы:&nbsp;{{exerciseInfo.score}} max&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Тестирование: {{challenge.name}}</div>
            <button *ngIf="sendMode" class="taskBtn" (click)="drawer.toggle()">Условия</button>
        </div>
            
        <div class="container">
            <div *ngIf="!sendMode; else send">
                <app-task [exerciseInfo]="exerciseInfo" [inOutData]="inOutData"></app-task>
                <button class="send" (click)="setSendMode()">Сдать задачу</button>
            </div>
            <ng-template #send>
                <div id="header">
                    <div class="wave">
                        <div class="correctInput" [ngClass]="{empty: !exerciseInfo.solutions[0]}">
                            <img
                                *ngIf="exerciseInfo.solutions[0]"
                                src="../../../assets/icon/statusCodes/{{solutionStatusIcon(getStatus())}}.svg"
                                [matTooltip]="solutionStatusTooltip(exerciseInfo.solutions[0].status)"
                                matTooltipPosition="above"
                            >
                        </div>
                    </div>
                </div>
                <table class="editor">
                    <tr>
                        <th col1></th>
                        <th col2>
                            <div class="buttons">
                                <img (click)="copy()" src="../../../assets/icon/copy.svg">
                                <a id="a" [href]="sanitize(solutionUrl)"><img class="download" src="../../../assets/icon/download.svg"></a>
                            </div>
                        </th>
                    </tr>
                    <div *ngIf="solutionPreview && model.language">
                        <tr *ngFor="let line of getCode(); let i = index; trackBy: trackByFn">
                            <td col1>{{i + 1}}</td>
                            <td col2><markdown [data]="line | language : model.language"></markdown></td>
                        </tr>
                    </div>
                    <tr>
                        <td col1></td>
                        <td col2></td>
                    </tr>
                </table>
            </ng-template>

            <div *ngIf="exerciseInfo.solutions && exerciseInfo.solutions.length > 0 && sendMode">
                <div class="header">Отправленные решения</div>
                <table class="solutions">
                    <thead>
                        <th>Время отправки</th>
                        <th>Язык</th>
                        <th>Скачать решение</th>
                        <th>Результат</th>
                    </thead>
                    <tbody>
                        <tr *ngFor="let sol of exerciseInfo.solutions">
                            <ng-container *ngIf="sol.exerciseId == exerciseInfo.id">
                                <td>{{prettyTime(sol.sendingTime)}}</td>
                                <td>{{normalLang(sol.language)}}</td>
                                <td (click)="downloadSolution(sol)">
                                    <div class="downSol">
                                        <span>Скачать</span>
                                        <img class="download" src="../../../assets/icon/download.svg">
                                    </div>
                                </td>
                                <td style="color: {{fontColor(sol.status)}}">
                                    <div class="downSol status" style="cursor: auto">
                                        <span>{{solutionStatusPresent(sol.status)}}</span>
                                        <img
                                            class="statusIcon"
                                            src="../../../assets/icon/statusCodes/{{solutionStatusIcon(sol.status)}}.svg"
                                            [matTooltip]="solutionStatusTooltip(exerciseInfo.solutions[0].status)"
                                            matTooltipPosition="above"
                                        />
                                    </div>
                                </td>
                            </ng-container>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div *ngIf="sendMode" class="submitCol">
            <div class="selectLanguage">
                <div class="select">
                    <span name="Language" *ngIf="model.language; else noLanguage">{{model.language}}</span>
                    <ng-template #noLanguage><span>Язык программирования</span><img src="../../../assets/icon/down-arrow.svg"></ng-template>
                </div>
                <ul class="submenu" id="sub">
                    <div>
                        <li *ngFor="let lang of availableLanguages" (click)="selectLanguage(lang)">
                            <div>
                                <span>{{lang}}</span>
                            </div>
                        </li>
                    </div>
                </ul>
            </div>
            <label for="sol" class="select">
                <span *ngIf="!model.file; else downloadedSolution">Загрузить решение</span>
                <ng-template #downloadedSolution><span>{{model.file.name}}</span></ng-template>
                <img src="../../../assets/icon/down-arrow.svg">
            </label>
            <input id="sol" type="file" style="display: none;" [accept]="selectedLanguage" (input)="setFile($event)">
            <div class="sendCont"><button id="send" (click)="onSubmit()">Отправить решение</button></div>
        </div>
    </div>
</div>

<ng-template #notReady>
    <div class="spinnerContainer">
        <div class="spinner"></div>
    </div>
</ng-template>
